# Example environment file for the photo-app server (safe to commit)

# Production safety:
# - The server will refuse startup in production if any of these are missing/empty:
#   JWT_SECRET, SUPABASE_URL, SUPABASE_ANON_KEY

# AI Configuration
OPENAI_API_KEY=your-openai-api-key
USE_LANGCHAIN=true
NOMINATIM_USER_AGENT=React-Photo-App/1.0

# JWT Configuration
JWT_SECRET=change-me-in-production
JWT_EXPIRES_IN=24h

# Server Configuration
PORT=3001
NODE_ENV=development
# ALLOW_DEV_DEBUG enables extra debug logging in logs (not security-related)
# Note: Debug routes (/debug/*) now require authentication in ALL environments
ALLOW_DEV_DEBUG=true

# Security Configuration
ENABLE_HTTPS=false
FORCE_HTTPS=false

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
AUTH_RATE_LIMIT_MAX=5
UPLOAD_RATE_LIMIT_MAX=20

# Database Configuration
DB_PATH=photos.db
# Database Connection
# For Local Docker: postgresql://photoapp:photoapp_dev@localhost:5432/photoapp
# For Supabase (Direct): postgresql://postgres:[PASSWORD]@db.[PROJECT].supabase.co:5432/postgres (IPv6 only!)
# For Supabase (Pooler): postgresql://postgres.[PROJECT]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres (IPv4 Compatible - Recommended)
SUPABASE_DB_URL=postgresql://user:pass@localhost:5432/postgres
SUPABASE_DB_URL_MIGRATIONS=postgresql://user:pass@localhost:5432/postgres

# Supabase Storage
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Storage Access Keys
SUPABASE_STORAGE_ACCESS_KEY_ID=your-access-key
SUPABASE_STORAGE_SECRET_KEY=your-secret-key

# File Upload Configuration
MAX_FILE_SIZE=50mb
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,heic,heif

# CORS Configuration
CORS_ORIGIN=http://localhost:3000,http://localhost:5173
CORS_CREDENTIALS=true

# Google Custom Search Configuration
GOOGLE_API_KEY=your-google-api-key
GOOGLE_CSE_ID=your-cse-id
# Specifically required by tests
GOOGLE_PLACES_API_KEY=your-google-places-api-key
GOOGLE_MAPS_API_KEY=${GOOGLE_PLACES_API_KEY}

# LangSmith / LangChain tracing
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=your-langsmith-api-key
LANGCHAIN_PROJECT=photo-app
# Photo App Server Configuration
# Copy this file to .env and fill in your actual values
# DO NOT COMMIT .env FILE TO GIT

# --- Environment ---
NODE_ENV=development
# ALLOW_DEV_DEBUG enables extra debug logging in logs (not security-related)
# Note: Debug routes (/debug/*) now require authentication in ALL environments
ALLOW_DEV_DEBUG=false  # Set to true for verbose logging in development

# E2E/Test-only routes hardening
# - /api/test/* and auth bypass hooks are disabled by default.
# - They are ALWAYS disabled in production regardless of this flag.
# - Enable ONLY for E2E runs (Playwright/Cypress) in non-production.
E2E_ROUTES_ENABLED=false

# --- Server ---
PORT=3001

# --- Authentication / JWT ---
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=24h

# --- Security ---
ENABLE_HTTPS=false
FORCE_HTTPS=false

# --- Rate Limiting ---
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
AUTH_RATE_LIMIT_MAX=5
UPLOAD_RATE_LIMIT_MAX=20

# --- Database Configuration ---
# SQLite (legacy/local dev)
DB_PATH=photos.db

# Supabase PostgreSQL URLs
# Use pooler URL for better reliability after restart
SUPABASE_DB_URL=postgresql://postgres.<project-ref>:<password>@<region>.pooler.supabase.com:5432/postgres
SUPABASE_DB_URL_MIGRATIONS=postgresql://postgres.<project-ref>:<password>@<region>.pooler.supabase.com:5432/postgres

# Database Connection Pool (Production Tuning)
# Adjust based on your deployment tier and traffic
DB_POOL_MIN=2
DB_POOL_MAX=20

# --- Supabase Storage ---
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your_public_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
SUPABASE_STORAGE_ACCESS_KEY_ID=your_storage_access_key_id
SUPABASE_STORAGE_SECRET_KEY=your_storage_secret_key

# --- Upload Limits ---
# Maximum allowed upload size in bytes (default: 10485760 = 10MB)
UPLOAD_MAX_BYTES=10485760

# --- AI Configuration ---
OPENAI_API_KEY=test_openai_key
USE_LANGCHAIN=true
NOMINATIM_USER_AGENT=React-Photo-App/1.0

# --- Image Caching ---
# Controls browser cache duration for /display/:state/:filename responses (in seconds)
# Default: 31536000 (1 year) with immutable directive for aggressive caching of hashed assets
IMAGE_CACHE_MAX_AGE=31536000

# LangSmith / LangChain tracing (optional)
LANGCHAIN_TRACING_V2=false
LANGCHAIN_API_KEY=your_langsmith_api_key
LANGCHAIN_PROJECT="photo app"

# --- Google Custom Search (optional) ---
GOOGLE_API_KEY=your_google_api_key
GOOGLE_CSE_ID=your_google_cse_id

# --- Google Places (optional, enables high-fidelity commercial POI lookups) ---
GOOGLE_PLACES_API_KEY=your_google_places_api_key
GOOGLE_MAPS_API_KEY=${GOOGLE_PLACES_API_KEY}

# --- File Upload Configuration ---
MAX_FILE_SIZE=50mb
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,heic,heif

# --- CORS Configuration ---
# FRONTEND_ORIGIN: Single frontend URL for Vercel/Netlify deployments
# Example: FRONTEND_ORIGIN=https://react-photo-il8l0cuz2-ron-inouyes-projects.vercel.app
FRONTEND_ORIGIN=

# ALLOWED_ORIGINS: Comma-separated list of allowed origins (overrides defaults)
# When set, localhost defaults are NOT included (production security)
# Example: ALLOWED_ORIGINS=https://app.example.com,https://staging.example.com
ALLOWED_ORIGINS=

# Legacy origin configuration (use FRONTEND_ORIGIN or ALLOWED_ORIGINS instead)
CORS_ORIGIN=http://localhost:3000,http://localhost:5173
CORS_CREDENTIALS=true

# --- Production Environment Variables ---
# Set these in your cloud deployment environment
# CLIENT_ORIGIN=https://www.your-photo-app.com
# API_URL=https://api.your-photo-app.com

# --- Migration/Debug Options ---
# Emergency bypass for local dev only (do not use in CI/Prod)
# SKIP_VERIFY_MIGRATIONS=true
#
# --- Debug Routes (HIGH RISK) ---
# Debug/diagnostic routes are disabled by default in production.
#
# - Production default: debug routes return 404 (not mounted + router guard)
# - To intentionally enable in production: set DEBUG_ROUTES_ENABLED=true
# - Optional additional gate: set DEBUG_ADMIN_TOKEN and provide header:
#     x-debug-token: <token>
DEBUG_ROUTES_ENABLED=false
DEBUG_ADMIN_TOKEN=change-me

# SerpAPI (optional, used by tests)
SERPAPI_API_KEY=your-serpapi-key
